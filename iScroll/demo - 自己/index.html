<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="http//cdn.bootcss.com/jquery/2.1.4/jquery.js"></script>
    <script src="iscroll-probe.js"></script>
    <style>
        body{
            margin:0;
        }
        #wrapper {
            position: absolute;
            z-index: 1;
            top: 0;
            bottom: 0;
            left: 0;
            width: 100%;
            background: #ccc;
            overflow: hidden;
        }
        #scroller {
            position: absolute;
            z-index: 1;
            -webkit-tap-highlight-color: rgba(0,0,0,0);
            width: 100%;
            -webkit-transform: translateZ(0);
            -moz-transform: translateZ(0);
            -ms-transform: translateZ(0);
            -o-transform: translateZ(0);
            transform: translateZ(0);
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-text-size-adjust: none;
            -moz-text-size-adjust: none;
            -ms-text-size-adjust: none;
            -o-text-size-adjust: none;
            text-size-adjust: none;
        }
        #scroller ul{
            margin:0;
            padding:0;
        }
        #scroller li{
            list-style-type:none;
            padding: 0 10px;
            height: 40px;
            line-height: 40px;
            border-bottom: 1px solid #ccc;
            border-top: 1px solid #fff;
            background-color: #fafafa;
            font-size: 14px;
        }
    </style>
    <title>iScroll</title>
</head>
<body onload="loaded()">
<div id="wrapper" data-index="0">
    <div id="scroller">
        <ul>
            <li>0</li>
            <li>1</li>
            <li>2</li>
            <li>3</li>
            <li>4</li>
            <li>5</li>
            <li>6</li>
            <li>7</li>
            <li>8</li>
            <li>9</li>
            <li>10</li>
            <li>11</li>
            <li>12</li>
            <li>13</li>
            <li>14</li>
            <li>15</li>
            <li>16</li>
            <li>17</li>
            <li>18</li>
            <li>19</li>
            <li>20</li>
            <li>21</li>
            <li>22</li>
            <li>23</li>
            <li>24</li>
            <li>25</li>
            <li>26</li>
            <li>27</li>
            <li>28</li>
            <li>29</li>
            <li>30</li>
            <li>31</li>
            <li>32</li>
            <li>33</li>
            <li>34</li>
            <li>35</li>
            <li>36</li>
            <li>37</li>
            <li>38</li>
            <li>39</li>
            <li>40</li>
            <li>41</li>
            <li>42</li>
            <li>43</li>
            <li>44</li>
            <li>45</li>
            <li>46</li>
            <li>47</li>
            <li>48</li>
            <li>49</li>
            <li>50</li>
            <li>51</li>
            <li>52</li>
            <li>53</li>
            <li>54</li>
            <li>55</li>
            <li>56</li>
            <li>57</li>
            <li>58</li>
            <li>59</li>
            <li>60</li>
            <li>61</li>
            <li>62</li>
            <li>63</li>
            <li>64</li>
            <li>65</li>
            <li>66</li>
            <li>67</li>
            <li>68</li>
            <li>69</li>
            <!--<li>0</li>-->
            <!--<li>1</li>-->
            <!--<li>2</li>-->
            <!--<li>3</li>-->
            <!--<li>4</li>-->
            <!--<li>5</li>-->
            <!--<li>6</li>-->
            <!--<li>7</li>-->
            <!--<li>8</li>-->
            <!--<li>9</li>-->
            <!--<li>10</li>-->
            <!--<li>11</li>-->
            <!--<li>12</li>-->
            <!--<li>13</li>-->
            <!--<li>14</li>-->
            <!--<li>15</li>-->
            <!--<li>16</li>-->
            <!--<li>17</li>-->
            <!--<li>18</li>-->
            <!--<li>19</li>-->
            <!--<li>20</li>-->
            <!--<li>21</li>-->
            <!--<li>22</li>-->
            <!--<li>23</li>-->
            <!--<li>24</li>-->
            <!--<li>25</li>-->
            <!--<li>26</li>-->
            <!--<li>27</li>-->
            <!--<li>28</li>-->
            <!--<li>29</li>-->
            <!--<li>30</li>-->
            <!--<li>31</li>-->
            <!--<li>32</li>-->
            <!--<li>33</li>-->
            <!--<li>34</li>-->
            <!--<li>35</li>-->
            <!--<li>36</li>-->
            <!--<li>37</li>-->
            <!--<li>38</li>-->
            <!--<li>39</li>-->
            <!--<li>40</li>-->
            <!--<li>41</li>-->
            <!--<li>42</li>-->
            <!--<li>43</li>-->
            <!--<li>44</li>-->
            <!--<li>45</li>-->
            <!--<li>46</li>-->
            <!--<li>47</li>-->
            <!--<li>48</li>-->
            <!--<li>49</li>-->
            <!--<li>50</li>-->
            <!--<li>51</li>-->
            <!--<li>52</li>-->
            <!--<li>53</li>-->
            <!--<li>54</li>-->
            <!--<li>55</li>-->
            <!--<li>56</li>-->
            <!--<li>57</li>-->
            <!--<li>58</li>-->
            <!--<li>59</li>-->
            <!--<li>60</li>-->
            <!--<li>61</li>-->
            <!--<li>62</li>-->
            <!--<li>63</li>-->
            <!--<li>64</li>-->
            <!--<li>65</li>-->
            <!--<li>66</li>-->
            <!--<li>67</li>-->
            <!--<li>68</li>-->
            <!--<li>69</li>-->
            <!--<li>0</li>-->
            <!--<li>1</li>-->
            <!--<li>2</li>-->
            <!--<li>3</li>-->
            <!--<li>4</li>-->
            <!--<li>5</li>-->
            <!--<li>6</li>-->
            <!--<li>7</li>-->
            <!--<li>8</li>-->
            <!--<li>9</li>-->
            <!--<li>10</li>-->
            <!--<li>11</li>-->
            <!--<li>12</li>-->
            <!--<li>13</li>-->
            <!--<li>14</li>-->
            <!--<li>15</li>-->
            <!--<li>16</li>-->
            <!--<li>17</li>-->
            <!--<li>18</li>-->
            <!--<li>19</li>-->
            <!--<li>20</li>-->
            <!--<li>21</li>-->
            <!--<li>22</li>-->
            <!--<li>23</li>-->
            <!--<li>24</li>-->
            <!--<li>25</li>-->
            <!--<li>26</li>-->
            <!--<li>27</li>-->
            <!--<li>28</li>-->
            <!--<li>29</li>-->
            <!--<li>30</li>-->
            <!--<li>31</li>-->
            <!--<li>32</li>-->
            <!--<li>33</li>-->
            <!--<li>34</li>-->
            <!--<li>35</li>-->
            <!--<li>36</li>-->
            <!--<li>37</li>-->
            <!--<li>38</li>-->
            <!--<li>39</li>-->
            <!--<li>40</li>-->
            <!--<li>41</li>-->
            <!--<li>42</li>-->
            <!--<li>43</li>-->
            <!--<li>44</li>-->
            <!--<li>45</li>-->
            <!--<li>46</li>-->
            <!--<li>47</li>-->
            <!--<li>48</li>-->
            <!--<li>49</li>-->
            <!--<li>50</li>-->
            <!--<li>51</li>-->
            <!--<li>52</li>-->
            <!--<li>53</li>-->
            <!--<li>54</li>-->
            <!--<li>55</li>-->
            <!--<li>56</li>-->
            <!--<li>57</li>-->
            <!--<li>58</li>-->
            <!--<li>59</li>-->
            <!--<li>60</li>-->
            <!--<li>61</li>-->
            <!--<li>62</li>-->
            <!--<li>63</li>-->
            <!--<li>64</li>-->
            <!--<li>65</li>-->
            <!--<li>66</li>-->
            <!--<li>67</li>-->
            <!--<li>68</li>-->
            <!--<li>69</li>-->
        </ul>
    </div>
</div>
<script>

    //推荐一个插件非常不错：https://github.com/ximan/dropload

    var myScroll;

    function loaded() {
        myScroll = new IScroll('#wrapper', {mouseWheel: true,probeType: 3});
        myScroll.on('scroll', updatePosition);
        myScroll.on("slideDown",function(){
            if(this.y > 40){
                //这里放下拉更新数据
                //alert("slideDown");
                $.ajax({
                    method: 'GET',
                    url: '/iScroll-json1',
                    dataType: 'json'
                }).done(function (data) {
                    var wrapper = document.getElementById("wrapper");
                    var wrapperUl = wrapper.getElementsByTagName('ul')[0];

                    var totalCount = data.all_row.length;                //总共文章数
                    var pageCount = 10;                                 //每一页有多少文章
                    var pageTotal = Math.ceil(totalCount/pageCount);    //一共有多少页
                    var index = wrapper.dataset.index;                 //我在html里id为wrapper的标签内存储了一下index
                    if(index == pageTotal){                            //当页数加载到最后一页的时候
                        console.log('已经没有了')
                    }else{
                        index++;                                        //这里索引增加
                        var startCount = pageCount*(index-1);           //索引页开始的条数脚标
                        var endCount = startCount + pageCount - 1;      //索引页结束的条数角脚标

                        for (j = startCount; j <= endCount; j++) {      //这里进行循环插入索引页的内容
                            var wrapperLi = document.createElement('li');
                            wrapperLi.innerHTML = data.all_row[j].row;
                            wrapperUl.appendChild(wrapperLi);
                        }

                        setTimeout(function () {                        //更新UI界面，避免显示数据，但是框架没有变大
                            myScroll.refresh();
                        }, 0);
                        wrapper.dataset.index = index;                  //    *这里存储一下索引
                    }
                });
            }

        });

        myScroll.on("slideUp",function(){
            if(this.maxScrollY - this.y > 40){
                //这里放上拉更新数据
                alert("slideUp");
            }
        });

        function updatePosition() {
            var y = this.y;
            var maxY = this.maxScrollY - y;

            //滚轮下拉，刷新效果

            if(y >= 40){
                console.log('slideDown1111111');

                //这里放箭头结束状态

                if(40 > y > 0){

                    //这里放箭头初始样式

                }
            }
            if(maxY >= 40){
                console.log('slideDown11111')

                //这里放箭头结束状态

                if(40 > maxY > 0){

                    //这里放箭头初始样式
                }
            }

        }

        document.addEventListener('touchmove', function (e) {
            e.preventDefault();
        }, false);
    }
</script>
<script>
//    自己写的，但是有bug
//
//    var getWrapper = document.getElementById('wrapper');
//    var getWrapperHeight = -(-document.getElementById('wrapper').scrollHeight + document.getElementById('wrapper').clientHeight + 32);
//    getWrapper.addEventListener('mousedown',getStartPage);
//
//    function getStartPage(e){
//        var e = e || window.event;
//        mouseY = e.pageY;
//        console.log(mouseY);
//        isDraging = true;
//        //return mouseY;
//    }
//
//    getWrapper.addEventListener('mousemove',getmovePage);
//
//    function getmovePage(e){
//
//        if(isDraging === true){
//            var e = e || window.event;
//            moveY = e.pageY;
//            console.log(moveY);
//            // return moveY;
//
//        }
//    }
//
//    getWrapper.addEventListener('mouseup',getmovePage);
//    isDraging = false;
//
//    if (this.y + getWrapperHeight < -2) {
//        if(mouseY-moveY>30){
//            console.log("向上拉动")
//        }
//
//    }
//
//    if (this.y > 20) {
//        if(mouseY-moveY<-30){
//            console.log("向下拉动")
//        }
//    }
//
//
//    Ajax调用
//
//    $.ajax({
//        method: 'GET',
//        url: '/iScroll-json1',
//        dataType: 'json',
//    }).done(function (data) {
//        var wrapper = document.getElementById("wrapper");
//        var wrapperUl = wrapper.getElementsByTagName('ul')[0];
//        //console.log(wrapperUl);
//        for (i = 0; i < data.all_row.length; i++) {
//            var wrapperLi = document.createElement('li');
//            wrapperLi.innerHTML = i;
//            wrapperUl.appendChild(wrapperLi);
//        }
//        setTimeout(function () {
//            myScroll.refresh();
//        }, 0);
//    });
</script>
</body>
</html>


