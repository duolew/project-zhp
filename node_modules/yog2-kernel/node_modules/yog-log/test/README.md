# yog-log 测试说明

此文档说明yog-log模块单测运行及测试点说明，目前已使用`mocha`对主要的功能点写单测，后续跟进功能升级需持续添加并更新此文档。

## 运行单测

单测使用mocha框架编写，文件为test目录`test.js`

 1. 安装mocha `npm install -g mocha`
 2. 在test目录运行`mocha test.js`
 
单测中需要判断程序异步执行结果且不支持callback的采取的是定时检测的方式，例如判断某个异步的log文件有没有生成。

## 测试点总结

| 测试对象  |       测试点   |      是否已有单测    | 
|  :----  |  :----        |   :----       | 
|  初始化配置   | 默认配置工作正常    |   有   | 
|  初始化配置   | 设置app名称且use_sub_dir=1时按建立app文件夹存储日志    |   有   | 
|  初始化配置   | 设置auto_rotate时按小时切分日志  |   有   | 
|  初始化配置   | 设置access_log_path把访问日志放在指定位置  |   有   | 
|  初始化配置   | 设置access_log_path异常时不报错(是否需要报错？)  |   有   | 
|  生成日志   | 设置IS_OMP=0是有两种日志生成。.wf.xx及.wf.new.xx|   有   | 
|  生成日志   | 普通的应用日志生成正常|   有   |
|  生成日志   | 访问日志生成正常|   有   |
|  生成日志   | 10位LogID大于0且保证一小时内唯一 |   暂未支持  |
|  生成日志   | 正常和错误的日志格式配置不报错 |   有  |
|  日志格式   | 默认的应用日志格式生成结果正常 |   有  |
|  日志格式   | 日期配置支持自定义 |   有  |
|  日志格式   | 获取单个cookie的配置正常 |   有  |
|  日志格式   | 获取单个cookie的解析正常 |   有  |
|  日志格式   | {u_xx}x自定义项配置解析正常 |   有  |
|  日志参数   | 支持自定义的日志参数打印 |   有 |
|  日志参数   | LogID获取方式 |   实例测试 |
|  日志调试   | 根据请求参数切换到调试模式 |   实例测试  |
|  日志调试   | 根据日志等级使用不同颜色标记 |   实例测试  |
|  日志调试   | 调试模式下去掉escape |   实例测试  |
|  模块中间件  | 在express中间件中使用正常 |   实例测试  |
|  模块中间件  | 通过domain传递logger实例正常 |   实例测试  |

## 实例使用教程

安装试用log模块，可本地或者全局安装yog-log。然后创建一个express实例，根据使用文档添加即可。

